<head>
  <title>TinyVote</title>
  <meta name="viewport" content="width=device-width, user-scalable=no">
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-md-6 col-md-offset-3">
        {{> navbar}}
        {{renderRouter}}

        <br />
        <br />
        <br />

        <hr />

        <p class="text-center">
          By <a href="https://twitter.com/stubailo">@stubailo</a>.
          <a href="https://github.com/stubailo/tinyvote">
            See code on GitHub</a>
        </p>
      </div>
    </div>
  </div>
</body>

<template name="navbar">
  <div class="navbar-tiny">
    <a href="/">
      <span class="glyphicon glyphicon-home"></span>
      TinyVote
    </a>

    {{#if currentUser}}
      {{#if ownedElections}}
        <div class="dropdown">
          <a class="dropdown-toggle" id="dropdownMenu1"
            data-toggle="dropdown" href="#">
              Your Elections
              <span class="caret"></span>
            </a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
            {{#each ownedElections}}
              <li role="presentation">
                <a role="menuitem" tabindex="-1" href="/{{slug}}">{{name}}</a>
              </li>
            {{/each}}
          </ul>
        </div>
      {{/if}}
    {{/if}}

    <div class="pull-right">{{loginButtons align="right"}}</div>
  </div>
</template>

<template name="loading">
  Loading...
</template>

<template name="home">
  <div class="text-center">
    <br />
    <h1>TinyVote</h1>
    <p class="lead">Run a simple election in seconds.</p>
  </div>

  <form class="new-election">
    <div class="form-group">
      <label class="sr-only">Election Name</label>
      <input type="text" class="form-control" name="name"
        placeholder="Election name" />
      {{#if formError "name"}}
        <div class="form-error">
          {{formError "name"}}
        </div>
      {{/if}}
    </div>
    <div class="form-group">
      <label class="sr-only">Candidates</label>
      <textarea class="form-control"
        placeholder="Candidates, one per line"
        name="candidates"></textarea>
      {{#if formError "candidates"}}
        <div class="form-error">
          {{formError "candidates"}}
        </div>
      {{/if}}
    </div>

    <div class="text-center">
      <button class="btn btn-primary btn-lg">Open Election</button>    
    </div>
  </form>
</template>

<template name="election">
  {{#unless closed}}
    {{#if isOwner}}
      <div class="panel panel-danger">
        <div class="panel-heading">
          Admin
        </div>
        <div class="panel-body">
          <p>Send the link below to participants.
            {{#if adminToken}}
              Save the URL for this page -
                this is your administrator link.
            {{/if}}
          </p>
          
          <input class="link" value="{{link}}" readonly />

          <p>
            <button class="btn btn-danger btn-sm close-vote">
              Close Voting and Display Winner</button>
          </p>
        </div>
      </div>
    {{/if}}
  {{/unless}}

  <h1>{{name}}</h1>

  {{#if closed}}
    <p class="lead">Election closed {{formatTime closedAt}},
      {{voteCount}} votes submitted</p>

    <h3>Winner: {{winner}}</h3>

    <hr />
    <h4>All Candidates</h4>
    <ul class="candidates">
      {{#each candidates}}
        <li>
          {{name}}
        </li>
      {{/each}}
    </ul>    
  {{else}}
    <p class="lead">Election opened {{formatTime createdAt}},
      {{pluralize voteCount "vote" "votes"}} submitted</p>

    <div class="row">
      <div class="col-xs-10">
        <div class="panel panel-default">
          <div class="panel-body">
            <p class="text-muted">Drag the candidates into the
              order of your preference, from best to worst.</p>

            <ul class="candidates sortable">
              {{#each candidates}}
                <li data-rank="{{rank}}" data-name="{{name}}">
                  {{index}}: {{name}}
                </li>
              {{/each}}
            </ul>

            <p class="text-muted">Your name will be needed
              in case you want to resubmit your vote.</p>
            <div class="form-group">
              <label class="sr-only">Name</label>
              <input type="text" name="voterName" placeholder="Your name"
                class="form-control" />
              {{#if formError "voterName"}}
                <div class="form-error">
                  {{formError "voterName"}}
                </div>
              {{/if}}
            </div>

            {{#if submitted}}
              <button class="btn btn-success submit-vote">
                Submitted for {{submitted}}
                <span class="glyphicon glyphicon-ok"></span>
              </button>
            {{else}}
              {{#if submitting}}
                <button class="btn btn-primary submit-vote">Submitting...</button>
              {{else}}
                <button class="btn btn-primary submit-vote">Submit Vote</button>
              {{/if}}
            {{/if}}

            <button class="btn btn-default reset">
              Reset Form</button>
          </div>
        </div>
      </div>
    </div>
  {{/if}}

</template>